<% const badgeClass = (lvl)=> lvl==='critical'?'badge-critical':(lvl==='at_risk'?'badge-risk':'badge-normal'); %>
<% const badgeText = (lvl)=> lvl==='critical'?'Crítico':(lvl==='at_risk'?'En riesgo':'Normal'); %>

<%- include('../../partials/layout', { title, body: `
  <div class='grid lg:grid-cols-3 gap-6'>
    <div class='lg:col-span-2 glass soft-shadow rounded-3xl p-8 fade-in'>
      <div class='text-2xl font-extrabold'>Hola, ${currentUser.full_name}</div>
      <div class='text-slate-600 mt-1'>Desde aquí puedes completar el cuestionario de bienestar psicológico.</div>

      <div class='mt-6 flex flex-col sm:flex-row gap-3'>
        <a class='btn btn-primary' href='/student/form'>Responder cuestionario</a>
        <a class='btn btn-secondary' href='/student/history'>Ver mis registros</a>
      </div>

      ${latest ? `
        <div class='mt-8 card glass rounded-3xl'>
          <div class='flex items-center justify-between gap-4'>
            <div>
              <div class='font-extrabold'>Último envío</div>
              <div class='text-sm text-slate-600'>${new Date(latest.created_at+'Z').toLocaleString('es-ES')}</div>
            </div>
            <div class='badge ${badgeClass(latest.risk_level)}'>${badgeText(latest.risk_level)} · ${latest.risk_score}</div>
          </div>
        </div>
      ` : `
        <div class='mt-8 card glass rounded-3xl'>
          <div class='font-bold'>Aún no has enviado respuestas.</div>
          <div class='text-sm text-slate-600 mt-1'>Cuando envíes tu primer cuestionario, aquí aparecerá un resumen.</div>
        </div>
      `}
    </div>

    <div class='glass soft-shadow rounded-3xl p-8 fade-in'>
      <div class='font-extrabold text-lg'>Privacidad</div>
      <p class='text-sm text-slate-600 mt-2'>Tus respuestas son confidenciales. Solo personal autorizado (rol administrador) puede ver casos en riesgo para brindar apoyo.</p>

      <div class='mt-6 card glass rounded-3xl'>
        <div class='font-bold'>Si estás en peligro inmediato</div>
        <div class='text-sm text-slate-600 mt-1'>Busca ayuda de emergencia local o contacta a un adulto de confianza.</div>
      </div>
    </div>
  </div>
` }) %>
